(function(e,_,d,p,f,a,y,N,R,g,r){"use strict";class x extends d{view(){const{message:s}=this.attrs,t=s||f.translator.trans("wusong8899-user-submission.lib.list-empty");return m("div",{className:"user-submission-empty-state"},t)}}class A extends d{view(){const{loading:s,hasMore:t,onClick:n}=this.attrs;return!t||s?null:m("div",{className:"user-submission-load-more-container"},m(a,{className:"Button Button--primary",disabled:s,loading:s,onclick:n},f.translator.trans("wusong8899-user-submission.lib.list-load-more")))}}class k extends d{view(){const{items:s,loading:t,hasMore:n,onLoadMore:o,renderItem:h,emptyMessage:w,className:c="user-submission-list"}=this.attrs;return m("div",null,m("ul",{className:c},s.map(u=>m("li",{key:u.id(),className:`${c}__item`},h(u)))),!t&&s.length===0&&m(x,{message:w}),m(A,{loading:t,hasMore:n&&!t,onClick:o}),t&&m("div",{className:"UserSubmission-loadMore"},m(p,{size:"large"})))}}const l=class l extends N{constructor(){super(...arguments),this.loading=!1}oninit(s){super.oninit(s),this.itemData=this.attrs.itemData,this.loading=!1}className(){return"Modal--small"}title(){return e.translator.trans("wusong8899-user-submission.admin.submission-review")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form-group user-submission-admin__modal-form-group"},a.component({className:"Button Button--primary user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"approved")}},e.translator.trans("wusong8899-user-submission.lib.accept"))," ",a.component({className:"Button Button--danger user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"rejected")}},e.translator.trans("wusong8899-user-submission.lib.decline"))," ",a.component({className:"Button user-submission-admin__modal-button",disabled:this.loading,onclick:()=>{this.hide()}},e.translator.trans("wusong8899-user-submission.lib.cancel"))))}reviewConfirm(s,t){s.preventDefault(),this.loading=!0,this.itemData.save({reviewResult:t}).then(()=>{this.hide(),this.loading=!1}).catch(()=>{this.loading=!1})}};l.isDismissibleViaBackdropClick=!1,l.isDismissibleViaCloseButton=!0;let b=l;class D extends y{view(){const{itemData:s}=this.attrs,t=s.amount(),n=s.user_account(),o=s.fromUser(),h=s.review_result(),w=e.translator.trans(h==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),c=s.assigned_at(),u=s.reviewed_at();return m("div",{className:"biddingRankSettingContainer"},m("div",{style:"float:right"},m("div",{style:"display: flex; gap: 5px; align-items: center;"},u&&m("div",null,a.component({style:"font-weight:bold;",disabled:!0,className:"Button"},e.translator.trans("wusong8899-user-submission.admin.list-reviewed"))),!u&&m("div",null,a.component({style:"font-weight:bold;",className:"Button Button--primary",onclick:()=>{this.reviewItem(s)}},e.translator.trans("wusong8899-user-submission.admin.list-review"))),m("div",null,a.component({className:"Button Button--danger",icon:"fas fa-trash",title:e.translator.trans("wusong8899-user-submission.admin.delete-submission"),onclick:()=>{this.deleteItem(s)}})))),m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-username"),": "),R(o)," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),t," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),c),m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),n),u&&m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),w," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),u))}reviewItem(s){e.modal.show(b,{itemData:s})}deleteItem(s){confirm(e.translator.trans("wusong8899-user-submission.admin.confirm-delete"))&&e.request({method:"DELETE",url:e.forum.attribute("apiUrl")+"/userSubmissionList/"+s.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(e.translator.trans("wusong8899-user-submission.admin.delete-failed"))})}}function L(){const i={loading:!0,moreResults:!1,items:[]};return{...i,...{setLoading(t){i.loading=t,g.redraw()},setMoreResults(t){i.moreResults=t},addItems(t){i.items.push(...t)},resetItems(){i.items=[]},hasMoreResults(){return i.moreResults},async loadMore(t){if(!i.loading){i.loading=!0,g.redraw();try{return await t(i.items.length)}catch(n){throw console.error("Error loading more items:",n),i.loading=!1,g.redraw(),n}}}}}}function B(i,s){let t=!1;if(s&&typeof s=="object"){const o=s;t=!!o.links?.next||!!o.meta?.hasMore||!!o.payload?.links?.next||Array.isArray(s)&&s.length>=20}i.setMoreResults(t);const n=Array.isArray(s)?s:s.data||[];return n.length>0&&i.addItems(n),i.setLoading(!1),Array.isArray(s)?s:n}class I extends _{constructor(){super(...arguments),this.pagination=L()}oninit(s){super.oninit(s),this.loadResults()}content(){return m("div",{className:"ExtensionPage-settings FlarumBadgesPage"},m("div",{className:"container"},m(k,{items:this.pagination.items,loading:this.pagination.loading,hasMore:this.pagination.hasMoreResults(),onLoadMore:()=>this.loadMore(),renderItem:s=>D.component({itemData:s}),className:"user-submission-admin__list"})))}async loadMore(){try{await this.pagination.loadMore(s=>this.loadResults(s))}catch(s){console.error("Failed to load more results:",s)}}parseResults(s){return B(this.pagination,s)}loadResults(s=0){return e.store.find("userSubmissionList",{page:{offset:s}}).catch(t=>(console.error("Failed to load user submissions:",t),this.pagination.setLoading(!1),[])).then(this.parseResults.bind(this))}}class v extends r{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const s=this.review_result();return s==="approved"?"approved":s==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(v.prototype,{id:r.attribute("id"),amount:r.attribute("amount",Number),user_account:r.attribute("user_account"),submission_user_id:r.attribute("submission_user_id"),review_user_id:r.attribute("review_user_id"),review_result:r.attribute("review_result"),assigned_at:r.attribute("assigned_at",r.transformDate),reviewed_at:r.attribute("reviewed_at",r.transformDate),created_at:r.attribute("created_at",r.transformDate),updated_at:r.attribute("updated_at",r.transformDate),fromUser:r.hasOne("fromUser"),reviewUser:r.hasOne("reviewUser")}),e.initializers.add("wusong8899-user-submission",()=>{e.store.models.userSubmissionList=v,e.extensionData.for("wusong8899-user-submission").registerPage(I)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/Component"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["forum/app"],flarum.core.compat["common/components/Button"],flarum.core.compat.Component,flarum.core.compat["common/components/Modal"],flarum.core.compat["common/helpers/username"],m,flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};