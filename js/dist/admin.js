(function(t,w,h,v,n,f,_,e,i){"use strict";const a=class a extends f{constructor(){super(...arguments),this.loading=!1}oninit(s){super.oninit(s),this.itemData=this.attrs.itemData,this.loading=!1}className(){return"Modal--small"}title(){return t.translator.trans("wusong8899-user-submission.admin.submission-review")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form-group user-submission-admin__modal-form-group"},m(n,{className:"Button Button--primary user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"approved")}},t.translator.trans("wusong8899-user-submission.lib.accept"))," ",m(n,{className:"Button Button--danger user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"rejected")}},t.translator.trans("wusong8899-user-submission.lib.decline"))," ",m(n,{className:"Button user-submission-admin__modal-button",disabled:this.loading,onclick:()=>{this.hide()}},t.translator.trans("wusong8899-user-submission.lib.cancel"))))}reviewConfirm(s,u){s.preventDefault(),this.loading=!0,t.request({method:"PATCH",url:t.forum.attribute("apiUrl")+"/userSubmissionList/"+this.itemData.id(),body:{data:{type:"userSubmissionList",id:this.itemData.id(),attributes:{reviewResult:u}}}}).then(()=>{this.hide(),this.loading=!1,window.location.reload()}).catch(l=>{this.loading=!1;const d=l.message||t.translator.trans("wusong8899-user-submission.admin.review-failed");alert(d)})}};a.isDismissibleViaBackdropClick=!1,a.isDismissibleViaCloseButton=!0;let o=a;class y extends v{view(){const{itemData:s}=this.attrs,u=s.amount(),l=s.user_account(),d=s.fromUser(),S=s.review_result(),N=t.translator.trans(S==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),g=s.assigned_at(),r=s.reviewed_at(),A=g?new Date(g).toLocaleString():"",L=r?new Date(r).toLocaleString():"";return m("div",{className:"biddingRankSettingContainer"},m("div",{style:"float:right"},m("div",{style:"display: flex; gap: 5px; align-items: center;"},r&&m("div",null,m(n,{style:"font-weight:bold;",disabled:!0,className:"Button"},t.translator.trans("wusong8899-user-submission.admin.list-reviewed"))),!r&&m("div",null,m(n,{style:"font-weight:bold;",className:"Button Button--primary",onclick:()=>{this.reviewItem(s)}},t.translator.trans("wusong8899-user-submission.admin.list-review"))),m("div",null,m(n,{className:"Button Button--danger",icon:"fas fa-trash",title:t.translator.trans("wusong8899-user-submission.admin.delete-submission"),onclick:()=>{this.deleteItem(s)}})))),m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-username"),": "),_(d)," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),u," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),A),m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),l),r&&m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),N," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),L))}reviewItem(s){t.modal.show(o,{itemData:s})}deleteItem(s){confirm(t.translator.trans("wusong8899-user-submission.admin.confirm-delete"))&&t.request({method:"DELETE",url:t.forum.attribute("apiUrl")+"/userSubmissionList/"+s.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(t.translator.trans("wusong8899-user-submission.admin.delete-failed"))})}}class D extends w{constructor(){super(...arguments),this.submissions=[],this.loading=!0}oninit(s){super.oninit(s),this.loadSubmissions()}content(){return e("div",{className:"ExtensionPage-settings"},e("div",{className:"container"},e("h2",null,t.translator.trans("wusong8899-user-submission.admin.title",{},!0)),this.loading?e(h,{size:"large"}):e("div",{className:"UserSubmissionList"},this.submissions.length===0?e("div",{className:"EmptyState"},e("p",null,t.translator.trans("wusong8899-user-submission.admin.no_submissions",{},!0))):e("div",{className:"UserSubmissionList-items"},this.submissions.map(s=>e(y,{key:s.id(),itemData:s}))))))}async loadSubmissions(){try{this.loading=!0;const s=await t.store.find("userSubmissionList",{page:{limit:50}});Array.isArray(s)?this.submissions=s:s&&s.data?this.submissions=s.data:this.submissions=[],console.log("Loaded submissions:",this.submissions)}catch(s){console.error("Failed to load submissions:",s),this.submissions=[]}finally{this.loading=!1,setTimeout(()=>e.redraw(),0)}}}class c extends i{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const s=this.review_result();return s==="approved"?"approved":s==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(c.prototype,{id:i.attribute("id"),amount:i.attribute("amount",Number),user_account:i.attribute("user_account"),submission_user_id:i.attribute("submission_user_id"),review_user_id:i.attribute("review_user_id"),review_result:i.attribute("review_result"),assigned_at:i.attribute("assigned_at",i.transformDate),reviewed_at:i.attribute("reviewed_at",i.transformDate),created_at:i.attribute("created_at",i.transformDate),updated_at:i.attribute("updated_at",i.transformDate),fromUser:i.hasOne("fromUser"),reviewUser:i.hasOne("reviewUser")}),t.initializers.add("wusong8899-user-submission",()=>{t.store.models.userSubmissionList=c,t.extensionData.for("wusong8899-user-submission").registerPage(D)})})(flarum.core.compat["admin/app"],flarum.core.compat["admin/components/ExtensionPage"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat.Component,flarum.core.compat["common/components/Button"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/helpers/username"],m,flarum.core.compat["common/Model"]);
//# sourceMappingURL=admin.js.map

module.exports={};