(function(t,f,u,_,w,r,p,y,N,i){"use strict";class R extends u{view(){const{message:s}=this.attrs,e=s||w.translator.trans("wusong8899-user-submission.lib.list-empty");return m("div",{className:"user-submission-empty-state"},e)}}class x extends u{view(){const{loading:s,hasMore:e,onClick:o}=this.attrs;return!e||s?null:m("div",{className:"user-submission-load-more-container"},m(r,{className:"Button Button--primary",disabled:s,loading:s,onclick:o},w.translator.trans("wusong8899-user-submission.lib.list-load-more")))}}class D extends u{view(){const{items:s,loading:e,hasMore:o,onLoadMore:g,renderItem:b,emptyMessage:h,className:d="user-submission-list"}=this.attrs;return m("div",null,m("ul",{className:d},s.map(a=>m("li",{key:a.id(),className:`${d}__item`},b(a)))),!e&&s.length===0&&m(R,{message:h}),m(x,{loading:e,hasMore:o&&!e,onClick:g}),e&&m("div",{className:"UserSubmission-loadMore"},m(_,{size:"large"})))}}const l=class l extends p{constructor(){super(...arguments),this.loading=!1}oninit(s){super.oninit(s),this.itemData=this.attrs.itemData,this.loading=!1}className(){return"Modal--small"}title(){return t.translator.trans("wusong8899-user-submission.admin.submission-review")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form-group user-submission-admin__modal-form-group"},r.component({className:"Button Button--primary user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"approved")}},t.translator.trans("wusong8899-user-submission.lib.accept"))," ",r.component({className:"Button Button--danger user-submission-admin__modal-button",disabled:this.loading,onclick:s=>{this.reviewConfirm(s,"rejected")}},t.translator.trans("wusong8899-user-submission.lib.decline"))," ",r.component({className:"Button user-submission-admin__modal-button",disabled:this.loading,onclick:()=>{this.hide()}},t.translator.trans("wusong8899-user-submission.lib.cancel"))))}reviewConfirm(s,e){s.preventDefault(),this.loading=!0,this.itemData.save({reviewResult:e}).then(()=>{this.hide(),this.loading=!1}).catch(()=>{this.loading=!1})}};l.isDismissibleViaBackdropClick=!1,l.isDismissibleViaCloseButton=!0;let c=l;class L extends u{view(){const{itemData:s}=this.attrs,e=s.amount(),o=s.user_account(),g=s.fromUser(),b=s.review_result(),h=t.translator.trans(b==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),d=s.assigned_at(),a=s.reviewed_at();return m("div",{className:"biddingRankSettingContainer"},m("div",{style:"float:right"},m("div",{style:"display: flex; gap: 5px; align-items: center;"},a&&m("div",null,r.component({style:"font-weight:bold;",disabled:!0,className:"Button"},t.translator.trans("wusong8899-user-submission.admin.list-reviewed"))),!a&&m("div",null,r.component({style:"font-weight:bold;",className:"Button Button--primary",onclick:()=>{this.reviewItem(s)}},t.translator.trans("wusong8899-user-submission.admin.list-review"))),m("div",null,r.component({className:"Button Button--danger",icon:"fas fa-trash",title:t.translator.trans("wusong8899-user-submission.admin.delete-submission"),onclick:()=>{this.deleteItem(s)}})))),m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-username"),": "),y(g)," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),e," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),d),m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),o),a&&m("div",null,m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),h," | ",m("b",null,t.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),a))}reviewItem(s){t.modal.show(c,{itemData:s})}deleteItem(s){confirm(t.translator.trans("wusong8899-user-submission.admin.confirm-delete"))&&t.request({method:"DELETE",url:t.forum.attribute("apiUrl")+"/userSubmissionList/"+s.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(t.translator.trans("wusong8899-user-submission.admin.delete-failed"))})}}function k(){const n={loading:!0,moreResults:!1,items:[]};return{...n,...{setLoading(e){n.loading=e,N.redraw()},setMoreResults(e){n.moreResults=e},addItems(e){n.items.push(...e)},resetItems(){n.items=[]},hasMoreResults(){return n.moreResults},async loadMore(e){this.setLoading(!0);try{await e(n.items.length)}catch{}finally{this.setLoading(!1)}}}}}function B(n,s){return n.setMoreResults(!!s.payload?.links?.next),n.addItems(s),n.setLoading(!1),s}class I extends f{constructor(){super(...arguments),this.pagination=k()}oninit(s){super.oninit(s),this.loadResults()}content(){return m("div",{className:"ExtensionPage-settings FlarumBadgesPage"},m("div",{className:"container"},m(D,{items:this.pagination.items,loading:this.pagination.loading,hasMore:this.pagination.hasMoreResults(),onLoadMore:()=>this.loadMore(),renderItem:s=>L.component({itemData:s}),className:"user-submission-admin__list"})))}loadMore(){this.pagination.loadMore(s=>this.loadResults(s))}parseResults(s){return B(this.pagination,s)}loadResults(s=0){return t.store.find("userSubmissionList",{page:{offset:s}}).catch(()=>[]).then(this.parseResults.bind(this))}}class v extends i{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const s=this.review_result();return s==="approved"?"approved":s==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(v.prototype,{id:i.attribute("id"),amount:i.attribute("amount",Number),user_account:i.attribute("user_account"),submission_user_id:i.attribute("submission_user_id"),review_user_id:i.attribute("review_user_id"),review_result:i.attribute("review_result"),assigned_at:i.attribute("assigned_at",i.transformDate),reviewed_at:i.attribute("reviewed_at",i.transformDate),created_at:i.attribute("created_at",i.transformDate),updated_at:i.attribute("updated_at",i.transformDate),fromUser:i.hasOne("fromUser"),reviewUser:i.hasOne("reviewUser")}),t.initializers.add("wusong8899-user-submission",()=>{t.store.models.userSubmissionList=v,t.extensionData.for("wusong8899-user-submission").registerPage(I)})})(flarum.core.compat["admin/app"],flarum.core.compat["components/ExtensionPage"],flarum.core.compat.Component,flarum.core.compat["components/LoadingIndicator"],flarum.core.compat["forum/app"],flarum.core.compat["components/Button"],flarum.core.compat["components/Modal"],flarum.core.compat["helpers/username"],m,flarum.core.compat.Model);
//# sourceMappingURL=admin.js.map

module.exports={};