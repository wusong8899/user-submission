(function(e,f,D,R,w,_,S,c,r,E,n,p,O,U,F,x,L,P){"use strict";const A=class A extends _{className(){return"Modal--small"}title(){return e.translator.trans("wusong8899-user-submission.forum.submit-success")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group",style:{textAlign:"center"}},m(c,{className:"Button Button--primary",onclick:()=>e.modal.close()},e.translator.trans("wusong8899-user-submission.lib.ok")))))}};A.isDismissible=!0;let v=A;const j={VALIDATION_RULES:{MIN_AMOUNT:.01,MAX_AMOUNT:999999.99,MAX_USER_ACCOUNT_LENGTH:500},ERROR_CODES:{INVALID_AMOUNT:"invalid_amount"}},k="/api/userSubmissionList",B=3,V=1e3;async function q(t){try{const s=W(t);if(s.length>0)throw new Error(s.map(o=>o.message).join(", "));const i=await I("POST",k,{data:{type:"userSubmissionList",attributes:t}});return z(i)}catch(s){throw H(s,"Failed to create user submission")}}function W(t){const s=[],{VALIDATION_RULES:i,ERROR_CODES:o}=j;return(!t.amount||t.amount<i.MIN_AMOUNT)&&s.push({field:"amount",message:e.translator.trans(`wusong8899-user-submission.lib.error.${o.INVALID_AMOUNT}`)}),t.amount>i.MAX_AMOUNT&&s.push({field:"amount",message:e.translator.trans("wusong8899-user-submission.lib.error.amount_too_large")}),(!t.userAccount||t.userAccount.trim().length===0)&&s.push({field:"userAccount",message:e.translator.trans("wusong8899-user-submission.lib.error.user_account_required")}),t.userAccount&&t.userAccount.length>i.MAX_USER_ACCOUNT_LENGTH&&s.push({field:"userAccount",message:e.translator.trans("wusong8899-user-submission.lib.error.user_account_too_long")}),s}async function I(t,s,i,o=0){try{return await e.request({method:t,url:s,body:i,headers:{"Content-Type":"application/json",Accept:"application/json"}})}catch(a){if(o<B&&G(a))return await X(V*Math.pow(2,o)),I(t,s,i,o+1);throw a}}function G(t){return t.status?t.status>=500&&t.status<600:!0}function X(t){return new Promise(s=>setTimeout(s,t))}function z(t){if(t&&t.data)return e.store.pushPayload(t),t.data;throw new Error("Invalid create response format")}function H(t,s){if(t.status===422&&t.errors){const i=t.errors.map(o=>o.detail||o.title).join(", ");return new Error(i)}switch(t.status){case 401:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.unauthorized"));case 403:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.forbidden"));case 404:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.not_found"));case 429:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.rate_limited"));case 500:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.server_error"));default:return new Error(t.message||s)}}const b=class b extends _{constructor(){super(...arguments),this.loading=!1,this.error=null}oninit(s){super.oninit(s),this.loading=!1,this.error=null,this.amount=S(""),this.userAccount=S("")}className(){return"Modal--small"}title(){return e.translator.trans("wusong8899-user-submission.forum.item-header")}content(){return r("div",{className:"Modal-body"},r("div",{className:"Form"},this.error&&r("div",{className:"Alert Alert--danger"},r("div",{className:"Alert-body"},this.error)),r("div",{className:"Form-group user-submission-modal__form-group"},r("div",null,r("div",{className:"userSubmissionDataLabel"},e.translator.trans("wusong8899-user-submission.lib.list-amount")),r("input",{type:"number",min:"0",step:"0.01",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("amount")?"FormControl--error":""}`,bidi:this.amount})),r("div",{className:"userSubmissionDataLabel"},e.translator.trans("wusong8899-user-submission.lib.list-userAccountFull")),r("input",{maxLength:"500",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("userAccount")?"FormControl--error":""}`,bidi:this.userAccount})),r("div",{className:"Form-group user-submission-modal__form-group"},r(c,{className:"Button Button--primary user-submission-modal__button",type:"submit",loading:this.loading},e.translator.trans("wusong8899-user-submission.lib.ok")),r(c,{className:"Button user-submission-modal__button",disabled:this.loading,onclick:()=>{e.modal.close()}},e.translator.trans("wusong8899-user-submission.lib.cancel")))))}async onsubmit(s){s.preventDefault(),this.error=null,this.loading=!0,r.redraw();try{const i={amount:parseFloat(this.amount())||0,userAccount:this.userAccount().trim()};await q(i),this.loading=!1,this.hide(),e.modal.show(v)}catch(i){this.loading=!1,this.error=i.message||e.translator.trans("wusong8899-user-submission.lib.error.unknown"),r.redraw()}}clearForm(){this.amount(""),this.userAccount(""),this.error=null}resetForm(){this.clearForm(),this.loading=!1}};b.isDismissibleViaBackdropClick=!1,b.isDismissibleViaCloseButton=!0;let d=b;const u=class u extends w{oncreate(s){super.oncreate(s),this.setupDynamicWidget()}onremove(){this.widgetElement&&this.widgetElement.remove()}view(){return this.renderWidgetContent()}renderWidgetContent(){return r("div",{className:"user-submission-widget"},r("div",{className:"user-submission-header"},r("img",{className:"user-submission-icon",src:"https://i.mji.rip/2025/08/15/102ee6e187aa177ddfe02364dc82208d.png",alt:"User Submission"}),r("span",{className:"user-submission-title"},e.translator.trans("wusong8899-user-submission.forum.item-header"))),r("div",{className:"user-submission-input-container"},r("div",{className:"user-submission-input-container__overlay",onclick:this.handleInputClick.bind(this)}),r("div",{className:"user-submission-input-container__search-input Search-input"},r("input",{disabled:!0,className:"FormControl",type:"search",placeholder:e.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))}setupDynamicWidget(){const s=setInterval(()=>{const i=document.querySelector(u.CONTAINER_SELECTOR);i&&!i.classList.contains(u.WIDGET_CLASS)&&(clearInterval(s),this.injectWidgetAfterContainer(i))},u.POLL_INTERVAL);setTimeout(()=>clearInterval(s),5e3)}injectWidgetAfterContainer(s){s.classList.add(u.WIDGET_CLASS),this.widgetElement=document.createElement("div"),this.widgetElement.className="user-submission-widget-dynamic",s.parentNode?.insertBefore(this.widgetElement,s.nextSibling),r.render(this.widgetElement,this.renderWidgetContent())}handleInputClick(){try{e.session.user?e.modal.show(d):e.modal.show(E)}catch{}}};u.POLL_INTERVAL=10,u.WIDGET_CLASS="UserSubmissionApplication",u.CONTAINER_SELECTOR=".TagsPage";let N=u;class y extends n{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const s=this.review_result();return s==="approved"?"approved":s==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(y.prototype,{id:n.attribute("id"),amount:n.attribute("amount",Number),user_account:n.attribute("user_account"),submission_user_id:n.attribute("submission_user_id"),review_user_id:n.attribute("review_user_id"),review_result:n.attribute("review_result"),assigned_at:n.attribute("assigned_at",n.transformDate),reviewed_at:n.attribute("reviewed_at",n.transformDate),created_at:n.attribute("created_at",n.transformDate),updated_at:n.attribute("updated_at",n.transformDate),fromUser:n.hasOne("fromUser"),reviewUser:n.hasOne("reviewUser")});class M extends w{view(){const{itemData:s}=this.attrs,i=s.amount(),o=s.id(),a=s.user_account(),h=s.review_result(),T=e.translator.trans(h==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),C=s.assigned_at(),l=s.reviewed_at(),$=C?new Date(C).toLocaleString():"",ss=l?new Date(l).toLocaleString():"";let g="userSubmissionApplicationContainer ";return l===null?g+="userSubmissionApplicationReviewing":h==="approved"?g+="userSubmissionApplicationAccepted":g+="userSubmissionApplicationDeclined",m("div",{className:g},m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-id"),": "),o," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),$),m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),i," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),a),l&&m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),h==="rejected"&&m("span",{className:"user-submission-status user-submission-status--rejected"},T," | "),h==="approved"&&m("span",{className:"user-submission-status user-submission-status--approved"},T," | "),m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),ss),!l&&m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),m("span",{className:"user-submission-status user-submission-status--reviewing"},e.translator.trans("wusong8899-user-submission.lib.list-submission-reviewing"))),m("div",{className:"user-submission-actions"},m(c,{className:"Button Button--danger Button--small",icon:"fas fa-trash",onclick:()=>this.deleteItem(s)},e.translator.trans("wusong8899-user-submission.forum.delete-submission"))))}deleteItem(s){confirm(e.translator.trans("wusong8899-user-submission.forum.confirm-delete"))&&e.request({method:"DELETE",url:e.forum.attribute("apiUrl")+"/userSubmissionList/"+s.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(e.translator.trans("wusong8899-user-submission.forum.delete-failed"))})}}class Y extends w{constructor(){super(...arguments),this.submissions=[],this.loading=!0}oninit(s){super.oninit(s),this.loadSubmissions()}view(){return r("div",{className:"UserSubmissionApplicationList"},this.loading?r(U,{size:"large"}):r("div",{className:"UserSubmissionApplicationList-items"},this.submissions.length===0?r("div",{className:"EmptyState"},r("p",null,e.translator.trans("wusong8899-user-submission.forum.no_applications"))):this.submissions.map(s=>r(M,{key:s.id(),itemData:s}))))}async loadSubmissions(){try{this.loading=!0;const s=await e.store.find("userSubmissionApplicationList",{page:{limit:50}});Array.isArray(s)?this.submissions=s:s&&s.data?this.submissions=s.data:this.submissions=[]}catch(s){console.error("Failed to load user applications:",s),this.submissions=[]}finally{this.loading=!1,setTimeout(()=>r.redraw(),0)}}}class J extends p{oninit(s){super.oninit(s),this.loadUser(m.route.param("username"))}content(){if(e.session.user){const s=e.session.user.id(),i=this.user.id();if(s===i)return m("div",null,m(Y,{params:{user:this.user}}))}return null}}function K(){e.routes["user.userSubmissionApplication"]={path:"/u/:username/userSubmissionApplication",component:J},f.extend(p.prototype,"navItems",function(t){if(e.session.user){const s=e.session.user.id(),i=this.user.id();s===i&&t.add("userSubmissionApplication",m(O,{href:e.route("user.userSubmissionApplication",{username:this.user.username()}),icon:"fas fa-file-signature"},e.translator.trans("wusong8899-user-submission.forum.application-list-title")),10)}})}class Q extends F{icon(){return null}href(){return e.route("user.userSubmissionApplication",{username:e.session.user.username()})}content(){return e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-title")}excerpt(){const s=this.attrs.notification.subject(),i=s.review_result(),o=s.id();if(i==="approved")return e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-success",{id:o});if(i==="rejected")return e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-failed",{id:o})}}class Z extends x{oninit(s){super.oninit(s)}view(){return m("div",{className:"MoneyLeaderboardPage"},L.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,P(L.prototype.sidebarItems().toArray()))),m("div",{className:"user-submission-header"},m("img",{className:"user-submission-icon",src:"https://mutluresim.com/images/2023/03/26/ViOux.png",alt:"User Submission"})," ",e.translator.trans("wusong8899-user-submission.forum.item-header")),m("div",{className:"user-submission-input-container"},m("div",{className:"user-submission-input-overlay",onclick:()=>this.openModal()}),m("div",{className:"Search-input"},m("input",{disabled:!0,className:"FormControl",type:"search",placeholder:e.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))))}openModal(){e.session.user?e.modal.show(d):e.modal.show(E)}}e.initializers.add("wusong8899-user-submission",()=>{e.routes.userSubmission={path:"/userSubmission",component:Z},e.store.models.userSubmissionList=y,e.notificationComponents.userSubmissionList=Q,f.extend(R.prototype,"view",function(){e.current.get("routeName")==="tags"&&new N().oncreate({})}),f.extend(D.prototype,"notificationTypes",function(t){t.add("userSubmissionList",{name:"userSubmissionList",icon:"fas fa-file-signature",label:e.translator.trans("wusong8899-user-submission.forum.notification-submission-result")})}),K()})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/NotificationGrid"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/Component"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Button"],m,flarum.core.compat["forum/components/LogInModal"],flarum.core.compat["common/Model"],flarum.core.compat["forum/components/UserPage"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["forum/components/Notification"],flarum.core.compat["common/components/Page"],flarum.core.compat["forum/components/IndexPage"],flarum.core.compat["common/helpers/listItems"]);
//# sourceMappingURL=forum.js.map

module.exports={};