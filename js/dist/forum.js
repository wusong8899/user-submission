(function(e,_,T,D,c,E,L,b,i,I,o,S,O,x,U,k,y,F){"use strict";const g=class g extends E{oninit(s){super.oninit(s)}className(){return"Modal--small"}title(){return e.translator.trans("wusong8899-user-submission.forum.submit-success")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group",style:"text-align: center;"},b.component({className:"Button Button--primary",onclick:()=>{this.hide()}},e.translator.trans("wusong8899-user-submission.lib.ok")))))}};g.isDismissibleViaBackdropClick=!1,g.isDismissibleViaCloseButton=!0;let A=g;const M={VALIDATION_RULES:{MIN_AMOUNT:.01,MAX_AMOUNT:999999.99,MAX_ACCOUNT_LENGTH:500},ERROR_CODES:{INVALID_AMOUNT:"invalid_amount"}},P="/api/userSubmissionList",j=3,B=1e3;async function V(t){try{const s=q(t);if(s.length>0)throw new Error(s.map(n=>n.message).join(", "));const r=await R("POST",P,{data:{type:"userSubmissionList",attributes:t}});return X(r)}catch(s){throw z(s,"Failed to create user submission")}}function q(t){const s=[],{VALIDATION_RULES:r,ERROR_CODES:n}=M;return(!t.amount||t.amount<r.MIN_AMOUNT)&&s.push({field:"amount",message:e.translator.trans(`wusong8899-user-submission.lib.error.${n.INVALID_AMOUNT}`)}),t.amount>r.MAX_AMOUNT&&s.push({field:"amount",message:e.translator.trans("wusong8899-user-submission.lib.error.amount_too_large")}),(!t.userAccount||t.userAccount.trim().length===0)&&s.push({field:"userAccount",message:e.translator.trans("wusong8899-user-submission.lib.error.user_account_required")}),t.userAccount&&t.userAccount.length>r.MAX_ACCOUNT_LENGTH&&s.push({field:"userAccount",message:e.translator.trans("wusong8899-user-submission.lib.error.user_account_too_long")}),s}async function R(t,s,r,n=0){try{return await e.request({method:t,url:s,body:r,headers:{"Content-Type":"application/json",Accept:"application/json"}})}catch(u){if(n<j&&W(u))return await G(B*Math.pow(2,n)),R(t,s,r,n+1);throw u}}function W(t){return t.status?t.status>=500&&t.status<600:!0}function G(t){return new Promise(s=>setTimeout(s,t))}function X(t){if(t&&t.data)return e.store.pushPayload(t),t.data;throw new Error("Invalid create response format")}function z(t,s){if(t.status===422&&t.errors){const r=t.errors.map(n=>n.detail||n.title).join(", ");return new Error(r)}switch(t.status){case 401:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.unauthorized"));case 403:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.forbidden"));case 404:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.not_found"));case 429:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.rate_limited"));case 500:return new Error(e.translator.trans("wusong8899-user-submission.lib.error.server_error"));default:return new Error(t.message||s)}}const f=class f extends E{constructor(){super(...arguments),this.loading=!1,this.error=null}oninit(s){super.oninit(s),this.loading=!1,this.error=null,this.amount=L(""),this.userAccount=L("")}className(){return"Modal--small"}title(){return e.translator.trans("wusong8899-user-submission.forum.item-header")}content(){return i("div",{className:"Modal-body"},i("div",{className:"Form"},this.error&&i("div",{className:"Alert Alert--danger"},i("div",{className:"Alert-body"},this.error)),i("div",{className:"Form-group user-submission-modal__form-group"},i("div",null,i("div",{className:"userSubmissionDataLabel"},e.translator.trans("wusong8899-user-submission.lib.list-amount")),i("input",{type:"number",min:"0",step:"0.01",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("amount")?"FormControl--error":""}`,bidi:this.amount})),i("div",{className:"userSubmissionDataLabel"},e.translator.trans("wusong8899-user-submission.lib.list-userAccountFull")),i("input",{maxLength:"500",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("userAccount")?"FormControl--error":""}`,bidi:this.userAccount})),i("div",{className:"Form-group user-submission-modal__form-group"},b.component({className:"Button Button--primary user-submission-modal__button",type:"submit",loading:this.loading},e.translator.trans("wusong8899-user-submission.lib.ok")),b.component({className:"Button user-submission-modal__button",disabled:this.loading,onclick:()=>{this.hide()}},e.translator.trans("wusong8899-user-submission.lib.cancel")))))}async onsubmit(s){s.preventDefault(),this.error=null,this.loading=!0,i.redraw();try{const r={amount:parseFloat(this.amount())||0,userAccount:this.userAccount().trim()};await V(r),this.loading=!1,this.hide(),e.modal.show(A)}catch(r){this.loading=!1,this.error=r.message||e.translator.trans("wusong8899-user-submission.lib.error.unknown"),i.redraw()}}clearForm(){this.amount(""),this.userAccount(""),this.error=null}resetForm(){this.clearForm(),this.loading=!1}};f.isDismissibleViaBackdropClick=!1,f.isDismissibleViaCloseButton=!0;let h=f;const a=class a extends c{oncreate(s){super.oncreate(s),this.setupDynamicWidget()}onremove(){this.widgetElement&&this.widgetElement.remove()}view(){return this.renderWidgetContent()}renderWidgetContent(){return i("div",{className:"user-submission-widget"},i("div",{className:"user-submission-header"},i("img",{className:"user-submission-icon",src:"https://i.mji.rip/2025/08/15/102ee6e187aa177ddfe02364dc82208d.png",alt:"User Submission"}),i("span",{className:"user-submission-title"},e.translator.trans("wusong8899-user-submission.forum.item-header"))),i("div",{className:"user-submission-input-container"},i("div",{className:"user-submission-input-container__overlay",onclick:this.handleInputClick.bind(this)}),i("div",{className:"user-submission-input-container__search-input Search-input"},i("input",{disabled:!0,className:"FormControl",type:"search",placeholder:e.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))}setupDynamicWidget(){const s=setInterval(()=>{const r=document.querySelector(a.CONTAINER_SELECTOR);r&&!r.classList.contains(a.WIDGET_CLASS)&&(clearInterval(s),this.injectWidgetAfterContainer(r))},a.POLL_INTERVAL);setTimeout(()=>clearInterval(s),5e3)}injectWidgetAfterContainer(s){s.classList.add(a.WIDGET_CLASS),this.widgetElement=document.createElement("div"),this.widgetElement.className="user-submission-widget-dynamic",s.parentNode?.insertBefore(this.widgetElement,s.nextSibling),i.render(this.widgetElement,this.renderWidgetContent())}handleInputClick(){try{e.session.user?e.modal.show(h):e.modal.show(I)}catch{}}};a.POLL_INTERVAL=10,a.WIDGET_CLASS="UserSubmissionApplication",a.CONTAINER_SELECTOR=".swiperTagContainer";let p=a;class C extends o{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const s=this.review_result();return s==="approved"?"approved":s==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(C.prototype,{id:o.attribute("id"),amount:o.attribute("amount",Number),user_account:o.attribute("user_account"),submission_user_id:o.attribute("submission_user_id"),review_user_id:o.attribute("review_user_id"),review_result:o.attribute("review_result"),assigned_at:o.attribute("assigned_at",o.transformDate),reviewed_at:o.attribute("reviewed_at",o.transformDate),created_at:o.attribute("created_at",o.transformDate),updated_at:o.attribute("updated_at",o.transformDate),fromUser:o.hasOne("fromUser"),reviewUser:o.hasOne("reviewUser")});class H extends c{view(){const{message:s}=this.attrs,r=s||e.translator.trans("wusong8899-user-submission.lib.list-empty");return m("div",{className:"user-submission-empty-state"},r)}}class Y extends c{view(){const{loading:s,hasMore:r,onClick:n}=this.attrs;return!r||s?null:m("div",{className:"user-submission-load-more-container"},m(b,{className:"Button Button--primary",disabled:s,loading:s,onclick:n},e.translator.trans("wusong8899-user-submission.lib.list-load-more")))}}class J extends c{view(){const{items:s,loading:r,hasMore:n,onLoadMore:u,renderItem:d,emptyMessage:w,className:v="user-submission-list"}=this.attrs;return m("div",null,m("ul",{className:v},s.map(l=>m("li",{key:l.id(),className:`${v}__item`},d(l)))),!r&&s.length===0&&m(H,{message:w}),m(Y,{loading:r,hasMore:n&&!r,onClick:u}),r&&m("div",{className:"UserSubmission-loadMore"},m(x,{size:"large"})))}}class K extends c{view(){const{itemData:s}=this.attrs,r=s.amount(),n=s.id(),u=s.user_account(),d=s.review_result(),w=e.translator.trans(d==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),v=s.assigned_at(),l=s.reviewed_at();let N="userSubmissionApplicationContainer ";return l===null?N+="userSubmissionApplicationReviewing":d==="approved"?N+="userSubmissionApplicationAccepted":N+="userSubmissionApplicationDeclined",m("div",{className:N},m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-id"),": "),n," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),v),m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),r," | ",m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),u),l&&m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),d==="rejected"&&m("span",{className:"user-submission-status user-submission-status--rejected"},w," | "),d==="approved"&&m("span",{className:"user-submission-status user-submission-status--approved"},w," | "),m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),l),!l&&m("div",null,m("b",null,e.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),m("span",{className:"user-submission-status user-submission-status--reviewing"},e.translator.trans("wusong8899-user-submission.lib.list-submission-reviewing"))),m("div",{className:"user-submission-actions"},b.component({className:"Button Button--danger Button--small",icon:"fas fa-trash",onclick:()=>this.deleteItem(s)},e.translator.trans("wusong8899-user-submission.forum.delete-submission"))))}deleteItem(s){confirm(e.translator.trans("wusong8899-user-submission.forum.confirm-delete"))&&e.request({method:"DELETE",url:e.forum.attribute("apiUrl")+"/userSubmissionList/"+s.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(e.translator.trans("wusong8899-user-submission.forum.delete-failed"))})}}function Q(){const t={loading:!0,moreResults:!1,items:[]};return{...t,...{setLoading(r){t.loading=r,i.redraw()},setMoreResults(r){t.moreResults=r},addItems(r){t.items.push(...r)},resetItems(){t.items=[]},hasMoreResults(){return t.moreResults},async loadMore(r){this.setLoading(!0);try{await r(t.items.length)}catch{}finally{this.setLoading(!1)}}}}}function Z(t,s){return t.setMoreResults(!!s.payload?.links?.next),t.addItems(s),t.setLoading(!1),s}class $ extends c{constructor(){super(...arguments),this.pagination=Q()}oninit(s){super.oninit(s),this.loadResults()}view(){return m(J,{items:this.pagination.items,loading:this.pagination.loading,hasMore:this.pagination.hasMoreResults(),onLoadMore:()=>this.loadMore(),renderItem:s=>K.component({itemData:s})})}loadMore(){this.pagination.loadMore(s=>this.loadResults(s))}parseResults(s){return Z(this.pagination,s)}loadResults(s=0){return e.store.find("userSubmissionApplicationList",{page:{offset:s}}).catch(()=>[]).then(this.parseResults.bind(this))}}class ss extends S{oninit(s){super.oninit(s),this.loadUser(m.route.param("username"))}content(){if(e.session.user){const s=e.session.user.id(),r=this.user.id();if(s===r)return m("div",null,$.component({params:{user:this.user}}))}return null}}function es(){e.routes["user.userSubmissionApplication"]={path:"/u/:username/userSubmissionApplication",component:ss},_.extend(S.prototype,"navItems",function(t){if(e.session.user){const s=e.session.user.id(),r=this.user.id();s===r&&t.add("userSubmissionApplication",O.component({href:e.route("user.userSubmissionApplication",{username:this.user.username()}),icon:"fas fa-file-signature"},[e.translator.trans("wusong8899-user-submission.forum.application-list-title")]),10)}})}class ts extends U{icon(){return null}href(){return e.route("user.userSubmissionApplication",{username:e.session.user.username()})}content(){return this.attrs.notification.subject(),e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-title")}excerpt(){const s=this.attrs.notification.subject(),r=s.review_result(),n=s.id();if(r==="approved")return e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-success",{id:n});if(r==="rejected")return e.translator.trans("wusong8899-user-submission.forum.notification-submission-result-failed",{id:n})}}class rs extends k{oninit(s){super.oninit(s)}view(){return m("div",{className:"MoneyLeaderboardPage"},y.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,F(y.prototype.sidebarItems().toArray()))),m("div",{className:"user-submission-header"},m("img",{className:"user-submission-icon",src:"https://mutluresim.com/images/2023/03/26/ViOux.png",alt:"User Submission"})," ",e.translator.trans("wusong8899-user-submission.forum.item-header")),m("div",{className:"user-submission-input-container"},m("div",{className:"user-submission-input-overlay",onclick:()=>this.openModal()}),m("div",{className:"Search-input"},m("input",{disabled:!0,className:"FormControl",type:"search",placeholder:e.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))))}openModal(){e.session.user?e.modal.show(h):e.modal.show(I)}}e.initializers.add("wusong8899-user-submission",()=>{e.routes.userSubmission={path:"/userSubmission",component:rs},e.store.models.userSubmissionList=C,e.notificationComponents.userSubmissionList=ts,_.extend(D.prototype,"view",function(){e.current.get("routeName")==="tags"&&new p().oncreate({})}),_.extend(T.prototype,"notificationTypes",function(t){t.add("userSubmissionList",{name:"userSubmissionList",icon:"fas fa-file-signature",label:e.translator.trans("wusong8899-user-submission.forum.notification-submission-result")})}),es()})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/NotificationGrid"],flarum.core.compat["forum/components/HeaderPrimary"],flarum.core.compat["common/Component"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Button"],m,flarum.core.compat["forum/components/LogInModal"],flarum.core.compat["common/Model"],flarum.core.compat["forum/components/UserPage"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["forum/components/Notification"],flarum.core.compat["common/components/Page"],flarum.core.compat["forum/components/IndexPage"],flarum.core.compat["common/helpers/listItems"]);
//# sourceMappingURL=forum.js.map

module.exports={};