(function(s,g,L,D,h,N,_,l,i,A,n,S,R,T,C,O,p,F){"use strict";const v=class v extends N{className(){return"Modal--small"}title(){return s.translator.trans("wusong8899-user-submission.forum.submit-success")}content(){return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group",style:{textAlign:"center"}},m(l,{className:"Button Button--primary",onclick:()=>s.modal.close()},s.translator.trans("wusong8899-user-submission.lib.ok")))))}};v.isDismissible=!0;let w=v;const x={VALIDATION_RULES:{MIN_AMOUNT:.01,MAX_AMOUNT:999999.99,MAX_USER_ACCOUNT_LENGTH:500},ERROR_CODES:{INVALID_AMOUNT:"invalid_amount"}},P="/api/userSubmissionList",j=3,k=1e3;async function B(t){try{const e=V(t);if(e.length>0)throw new Error(e.map(o=>o.message).join(", "));const r=await y("POST",P,{data:{type:"userSubmissionList",attributes:t}});return X(r)}catch(e){throw z(e,"Failed to create user submission")}}function V(t){const e=[],{VALIDATION_RULES:r,ERROR_CODES:o}=x;return(!t.amount||t.amount<r.MIN_AMOUNT)&&e.push({field:"amount",message:s.translator.trans(`wusong8899-user-submission.lib.error.${o.INVALID_AMOUNT}`)}),t.amount>r.MAX_AMOUNT&&e.push({field:"amount",message:s.translator.trans("wusong8899-user-submission.lib.error.amount_too_large")}),(!t.userAccount||t.userAccount.trim().length===0)&&e.push({field:"userAccount",message:s.translator.trans("wusong8899-user-submission.lib.error.user_account_required")}),t.userAccount&&t.userAccount.length>r.MAX_USER_ACCOUNT_LENGTH&&e.push({field:"userAccount",message:s.translator.trans("wusong8899-user-submission.lib.error.user_account_too_long")}),e}async function y(t,e,r,o=0){try{return await s.request({method:t,url:e,body:r,headers:{"Content-Type":"application/json",Accept:"application/json"}})}catch(u){if(o<j&&q(u))return await W(k*Math.pow(2,o)),y(t,e,r,o+1);throw u}}function q(t){return t.status?t.status>=500&&t.status<600:!0}function W(t){return new Promise(e=>setTimeout(e,t))}function X(t){if(t&&t.data)return s.store.pushPayload(t),t.data;throw new Error("Invalid create response format")}function z(t,e){if(t.status===422&&t.errors){const r=t.errors.map(o=>o.detail||o.title).join(", ");return new Error(r)}switch(t.status){case 401:return new Error(s.translator.trans("wusong8899-user-submission.lib.error.unauthorized"));case 403:return new Error(s.translator.trans("wusong8899-user-submission.lib.error.forbidden"));case 404:return new Error(s.translator.trans("wusong8899-user-submission.lib.error.not_found"));case 429:return new Error(s.translator.trans("wusong8899-user-submission.lib.error.rate_limited"));case 500:return new Error(s.translator.trans("wusong8899-user-submission.lib.error.server_error"));default:return new Error(t.message||e)}}const d=class d extends N{constructor(){super(...arguments),this.loading=!1,this.error=null}oninit(e){super.oninit(e),this.loading=!1,this.error=null,this.amount=_(""),this.userAccount=_("")}className(){return"Modal--small"}title(){return s.translator.trans("wusong8899-user-submission.forum.item-header")}content(){return i("div",{className:"Modal-body"},i("div",{className:"Form"},this.error&&i("div",{className:"Alert Alert--danger"},i("div",{className:"Alert-body"},this.error)),i("div",{className:"Form-group user-submission-modal__form-group"},i("div",null,i("div",{className:"userSubmissionDataLabel"},s.translator.trans("wusong8899-user-submission.lib.list-amount")),i("input",{type:"number",min:"0",step:"0.01",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("amount")?"FormControl--error":""}`,bidi:this.amount})),i("div",{className:"userSubmissionDataLabel"},s.translator.trans("wusong8899-user-submission.lib.list-userAccountFull")),i("input",{maxLength:"500",disabled:this.loading,required:!0,className:`FormControl ${this.error&&this.error.includes("userAccount")?"FormControl--error":""}`,bidi:this.userAccount})),i("div",{className:"Form-group user-submission-modal__form-group"},i(l,{className:"Button Button--primary user-submission-modal__button",type:"submit",loading:this.loading},s.translator.trans("wusong8899-user-submission.lib.ok")),i(l,{className:"Button user-submission-modal__button",disabled:this.loading,onclick:()=>{s.modal.close()}},s.translator.trans("wusong8899-user-submission.lib.cancel")))))}async onsubmit(e){e.preventDefault(),this.error=null,this.loading=!0,i.redraw();try{const r={amount:parseFloat(this.amount())||0,userAccount:this.userAccount().trim()};await B(r),this.loading=!1,this.hide(),s.modal.show(w)}catch(r){this.loading=!1,this.error=r.message||s.translator.trans("wusong8899-user-submission.lib.error.unknown"),i.redraw()}}clearForm(){this.amount(""),this.userAccount(""),this.error=null}resetForm(){this.clearForm(),this.loading=!1}};d.isDismissibleViaBackdropClick=!1,d.isDismissibleViaCloseButton=!0;let c=d;class G extends h{view(){return s.current.get("routeName")!=="tags"?null:m("div",{className:"user-submission-widget-dynamic"},this.renderWidgetContent())}renderWidgetContent(){return m("div",{className:"user-submission-widget"},m("div",{className:"user-submission-header"},m("img",{className:"user-submission-icon",src:"https://i.mji.rip/2025/08/15/102ee6e187aa177ddfe02364dc82208d.png",alt:"User Submission"}),m("span",{className:"user-submission-title"},s.translator.trans("wusong8899-user-submission.forum.item-header"))),m("div",{className:"user-submission-input-container"},m("div",{className:"user-submission-input-container__overlay",onclick:this.handleInputClick.bind(this)}),m("div",{className:"user-submission-input-container__search-input Search-input"},m("input",{disabled:!0,className:"FormControl",type:"search",placeholder:s.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))}handleInputClick(){try{s.session.user?s.modal.show(c):s.modal.show(A)}catch{}}}class E extends n{isPending(){return this.review_result()===null&&this.review_user_id()===null}isApproved(){return this.review_result()==="approved"}isRejected(){return this.review_result()==="rejected"}getReviewStatus(){const e=this.review_result();return e==="approved"?"approved":e==="rejected"?"rejected":"pending"}getFormattedAmount(){return this.amount().toFixed(2)}canEdit(){return this.isPending()}getTimeSinceSubmission(){return Date.now()-this.created_at().getTime()}}Object.assign(E.prototype,{id:n.attribute("id"),amount:n.attribute("amount",Number),user_account:n.attribute("user_account"),submission_user_id:n.attribute("submission_user_id"),review_user_id:n.attribute("review_user_id"),review_result:n.attribute("review_result"),assigned_at:n.attribute("assigned_at",n.transformDate),reviewed_at:n.attribute("reviewed_at",n.transformDate),created_at:n.attribute("created_at",n.transformDate),updated_at:n.attribute("updated_at",n.transformDate),fromUser:n.hasOne("fromUser"),reviewUser:n.hasOne("reviewUser")});class M extends h{view(){const{itemData:e}=this.attrs,r=e.amount(),o=e.id(),u=e.user_account(),b=e.review_result(),U=s.translator.trans(b==="approved"?"wusong8899-user-submission.lib.list-submission-accept":"wusong8899-user-submission.lib.list-submission-decline"),I=e.assigned_at(),a=e.reviewed_at(),Z=I?new Date(I).toLocaleString():"",$=a?new Date(a).toLocaleString():"";let f="userSubmissionApplicationContainer ";return a===null?f+="userSubmissionApplicationReviewing":b==="approved"?f+="userSubmissionApplicationAccepted":f+="userSubmissionApplicationDeclined",m("div",{className:f},m("div",null,m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-id"),": "),o," | ",m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-assignedAt"),": "),Z),m("div",null,m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-amount"),": "),r," | ",m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-userAccount"),": "),u),a&&m("div",null,m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),b==="rejected"&&m("span",{className:"user-submission-status user-submission-status--rejected"},U," | "),b==="approved"&&m("span",{className:"user-submission-status user-submission-status--approved"},U," | "),m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-reviewAt"),": "),$),!a&&m("div",null,m("b",null,s.translator.trans("wusong8899-user-submission.lib.list-reviewResult"),": "),m("span",{className:"user-submission-status user-submission-status--reviewing"},s.translator.trans("wusong8899-user-submission.lib.list-submission-reviewing"))),m("div",{className:"user-submission-actions"},m(l,{className:"Button Button--danger Button--small",icon:"fas fa-trash",onclick:()=>this.deleteItem(e)},s.translator.trans("wusong8899-user-submission.forum.delete-submission"))))}deleteItem(e){confirm(s.translator.trans("wusong8899-user-submission.forum.confirm-delete"))&&s.request({method:"DELETE",url:s.forum.attribute("apiUrl")+"/userSubmissionList/"+e.id()}).then(()=>{window.location.reload()}).catch(()=>{alert(s.translator.trans("wusong8899-user-submission.forum.delete-failed"))})}}class H extends h{constructor(){super(...arguments),this.submissions=[],this.loading=!0}oninit(e){super.oninit(e),this.loadSubmissions()}view(){return i("div",{className:"UserSubmissionApplicationList"},this.loading?i(T,{size:"large"}):i("div",{className:"UserSubmissionApplicationList-items"},this.submissions.length===0?i("div",{className:"EmptyState"},i("p",null,s.translator.trans("wusong8899-user-submission.forum.no_applications"))):this.submissions.map(e=>i(M,{key:e.id(),itemData:e}))))}async loadSubmissions(){try{this.loading=!0;const e=await s.store.find("userSubmissionApplicationList",{page:{limit:50}});Array.isArray(e)?this.submissions=e:e&&e.data?this.submissions=e.data:this.submissions=[]}catch(e){console.error("Failed to load user applications:",e),this.submissions=[]}finally{this.loading=!1,setTimeout(()=>i.redraw(),0)}}}class Y extends S{oninit(e){super.oninit(e),this.loadUser(m.route.param("username"))}content(){if(s.session.user){const e=s.session.user.id(),r=this.user.id();if(e===r)return m("div",null,m(H,{params:{user:this.user}}))}return null}}function J(){s.routes["user.userSubmissionApplication"]={path:"/u/:username/userSubmissionApplication",component:Y},g.extend(S.prototype,"navItems",function(t){if(s.session.user){const e=s.session.user.id(),r=this.user.id();e===r&&t.add("userSubmissionApplication",m(R,{href:s.route("user.userSubmissionApplication",{username:this.user.username()}),icon:"fas fa-file-signature"},s.translator.trans("wusong8899-user-submission.forum.application-list-title")),10)}})}class K extends C{icon(){return null}href(){return s.route("user.userSubmissionApplication",{username:s.session.user.username()})}content(){return s.translator.trans("wusong8899-user-submission.forum.notification-submission-result-title")}excerpt(){const e=this.attrs.notification.subject(),r=e.review_result(),o=e.id();if(r==="approved")return s.translator.trans("wusong8899-user-submission.forum.notification-submission-result-success",{id:o});if(r==="rejected")return s.translator.trans("wusong8899-user-submission.forum.notification-submission-result-failed",{id:o})}}class Q extends O{oninit(e){super.oninit(e)}view(){return m("div",{className:"MoneyLeaderboardPage"},p.prototype.hero(),m("div",{className:"container"},m("div",{className:"sideNavContainer"},m("nav",{className:"IndexPage-nav sideNav"},m("ul",null,F(p.prototype.sidebarItems().toArray()))),m("div",{className:"user-submission-header"},m("img",{className:"user-submission-icon",src:"https://mutluresim.com/images/2023/03/26/ViOux.png",alt:"User Submission"})," ",s.translator.trans("wusong8899-user-submission.forum.item-header")),m("div",{className:"user-submission-input-container"},m("div",{className:"user-submission-input-overlay",onclick:()=>this.openModal()}),m("div",{className:"Search-input"},m("input",{disabled:!0,className:"FormControl",type:"search",placeholder:s.translator.trans("wusong8899-user-submission.forum.item-input-placeholder")}))))))}openModal(){s.session.user?s.modal.show(c):s.modal.show(A)}}s.initializers.add("wusong8899-user-submission",()=>{s.routes.userSubmission={path:"/userSubmission",component:Q},s.store.models.userSubmissionList=E,s.notificationComponents.userSubmissionList=K,g.override(D.prototype,"view",function(t){try{const e=t(),r=i(G);return Array.isArray(e)?[...e,r]:[e,r]}catch(e){return console.error("UserSubmissionWidget integration error:",e),t()}}),g.extend(L.prototype,"notificationTypes",function(t){t.add("userSubmissionList",{name:"userSubmissionList",icon:"fas fa-file-signature",label:s.translator.trans("wusong8899-user-submission.forum.notification-submission-result")})}),J()})})(flarum.core.compat["forum/app"],flarum.core.compat["common/extend"],flarum.core.compat["forum/components/NotificationGrid"],flarum.core.compat["tags/forum/components/TagsPage"],flarum.core.compat["common/Component"],flarum.core.compat["common/components/Modal"],flarum.core.compat["common/utils/Stream"],flarum.core.compat["common/components/Button"],m,flarum.core.compat["forum/components/LogInModal"],flarum.core.compat["common/Model"],flarum.core.compat["forum/components/UserPage"],flarum.core.compat["common/components/LinkButton"],flarum.core.compat["common/components/LoadingIndicator"],flarum.core.compat["forum/components/Notification"],flarum.core.compat["common/components/Page"],flarum.core.compat["forum/components/IndexPage"],flarum.core.compat["common/helpers/listItems"]);
//# sourceMappingURL=forum.js.map

module.exports={};