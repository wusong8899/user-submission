{"version":3,"file":"admin.js","sources":["../src/admin/components/UserSubmissionReviewModal.jsx","../src/admin/components/UserSubmissionListItem.jsx","../src/admin/components/SettingsPage.jsx","../src/forum/model/UserSubmission.js","../src/admin/index.js"],"sourcesContent":["import Modal from 'flarum/components/Modal';\r\nimport Button from 'flarum/components/Button';\r\n\r\nexport default class UserSubmissionReviewModal extends Modal {\r\n  static isDismissibleViaBackdropClick = false;\r\n  static isDismissibleViaCloseButton = true;\r\n\r\n  oninit(vnode) {\r\n    super.oninit(vnode);\r\n    this.itemData = this.attrs.itemData;\r\n    this.loading = false;\r\n  }\r\n\r\n  className() {\r\n    return 'Modal--small';\r\n  }\r\n\r\n  title() {\r\n    return app.translator.trans('wusong8899-user-submission.admin.submission-review');\r\n  }\r\n\r\n  content() {\r\n    //\r\n    return (\r\n      <div className=\"Modal-body\">\r\n        <div className=\"Form-group\" style=\"text-align: center;\">\r\n          {Button.component(\r\n            {\r\n              style: 'min-width:66px;',\r\n              className: 'Button Button--primary',\r\n              disabled: this.loading,\r\n              onclick: (e) => {\r\n                this.reviewConfirm(e,1);\r\n              }\r\n            },\r\n            app.translator.trans('wusong8899-user-submission.lib.accept')\r\n          )}&nbsp;\r\n          {Button.component(\r\n            {\r\n              style: 'min-width:66px;',\r\n              className: 'Button Button--danger',\r\n              disabled: this.loading,\r\n              onclick: (e) => {\r\n                this.reviewConfirm(e,0);\r\n              }\r\n            },\r\n            app.translator.trans('wusong8899-user-submission.lib.decline')\r\n          )}&nbsp;\r\n          {Button.component(\r\n            {\r\n              style: 'min-width:66px;',\r\n              className: 'Button',\r\n              disabled: this.loading,\r\n              onclick: () => {\r\n                this.hide();\r\n              }\r\n            },\r\n            app.translator.trans('wusong8899-user-submission.lib.cancel')\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  reviewConfirm(e,value) {\r\n    e.preventDefault();\r\n\r\n    this.loading = true;\r\n    this.itemData.save({\r\n      reviewResult:value,\r\n    })\r\n    .then( \r\n      () => {\r\n        this.hide(),\r\n        this.loading = false;\r\n      }\r\n    );\r\n  }\r\n}\r\n","import Component from \"flarum/Component\";\r\nimport Button from 'flarum/components/Button';\r\nimport UserSubmissionReviewModal from './UserSubmissionReviewModal';\r\nimport username from \"flarum/helpers/username\";\r\n\r\nexport default class UserSubmissionListItem extends Component {\r\n\r\n  view() {\r\n    const {itemData} = this.attrs;\r\n\r\n    const amount = itemData.amount();\r\n    const platform = itemData.platform();\r\n    const platformAccount = itemData.platform_account();\r\n    const userAccount = itemData.user_account();\r\n    const fromUser = itemData.fromUser();\r\n    const reviewResult = itemData.review_result();\r\n    const reviewResultText = app.translator.trans(reviewResult===1?'wusong8899-user-submission.lib.list-submission-accept':'wusong8899-user-submission.lib.list-submission-decline');\r\n    const assignedAt = itemData.assigned_at();\r\n    const reviewedAt = itemData.reviewed_at();\r\n\r\n    // const bidText = moneyName.replace('[money]', bidValue);\r\n\r\n    return (\r\n      <div className=\"biddingRankSettingContainer\">\r\n        <div style=\"float:right\">\r\n          {reviewedAt && (\r\n            <div style=\"padding:0px 0px 5px 5px\">\r\n              {Button.component({\r\n                style: \"font-weight:bold;\",\r\n                disabled: true,\r\n                className: 'Button',\r\n              },\r\n              app.translator.trans('wusong8899-user-submission.admin.list-reviewed')\r\n              )}\r\n            </div>\r\n          )}\r\n          {!reviewedAt && (\r\n            <div style=\"padding:0px 0px 5px 5px\">\r\n              {Button.component({\r\n                style: \"font-weight:bold;\",\r\n                className: 'Button Button--primary',\r\n                onclick: () => {\r\n                  this.reviewItem(itemData)\r\n                }\r\n              },\r\n              app.translator.trans('wusong8899-user-submission.admin.list-review')\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div>\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-username')}: </b>\r\n          {username(fromUser)}&nbsp;|&nbsp;\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-amount')}: </b>\r\n          {amount}&nbsp;|&nbsp;\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-assignedAt')}: </b>\r\n          {assignedAt}\r\n        </div>\r\n        <div>\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-platform')}: </b>\r\n          {platform}&nbsp;|&nbsp;\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-platformAccount')}: </b>\r\n          {platformAccount}&nbsp;|&nbsp;\r\n          <b>{app.translator.trans('wusong8899-user-submission.lib.list-userAccount')}: </b>\r\n          {userAccount}\r\n        </div>\r\n        {reviewedAt && (\r\n          <div>\r\n            <b>{app.translator.trans('wusong8899-user-submission.lib.list-reviewResult')}: </b>\r\n            {reviewResultText}&nbsp;|&nbsp;\r\n            <b>{app.translator.trans('wusong8899-user-submission.lib.list-reviewAt')}: </b>\r\n            {reviewedAt}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  reviewItem(itemData){\r\n    app.modal.show(UserSubmissionReviewModal, {itemData});\r\n  }\r\n}\r\n","import ExtensionPage from 'flarum/components/ExtensionPage';\r\nimport LoadingIndicator from 'flarum/components/LoadingIndicator';\r\nimport Button from 'flarum/components/Button';\r\nimport UserSubmissionListItem from './UserSubmissionListItem';\r\n\r\nexport default class DecorationStoreSettings extends ExtensionPage {\r\n  oninit(attrs) {\r\n    super.oninit(attrs);\r\n    this.loading = true;\r\n    this.moreResults = false;\r\n    this.userSubmissionList = [];\r\n    this.loadResults();\r\n  }\r\n\r\n  content() {\r\n    let loading;\r\n\r\n    if(this.loading){\r\n      loading = LoadingIndicator.component({ size: \"large\" });\r\n    }\r\n\r\n    return (\r\n      <div className=\"ExtensionPage-settings FlarumBadgesPage\">\r\n        <div className=\"container\">\r\n\r\n          <ul style=\"padding:0px;list-style-type: none;\">\r\n            {this.userSubmissionList.map((itemData) => {\r\n              return (\r\n                <li itemID={itemData.id()} style=\"margin-top:5px;background: var(--body-bg);\">\r\n                  {UserSubmissionListItem.component({ itemData })}\r\n                </li>\r\n              );\r\n            })}\r\n          </ul>\r\n\r\n          {!this.loading && this.userSubmissionList.length===0 && (\r\n            <div>\r\n              <div style=\"font-size:1.4em;color: var(--muted-more-color);text-align: center;line-height: 100px;\">{app.translator.trans(\"wusong8899-decoration-store.lib.list-empty\")}</div>\r\n            </div>\r\n          )}\r\n\r\n          {!loading && this.hasMoreResults() && (\r\n            <div style=\"text-align:center;padding:20px\">\r\n              <Button className={'Button Button--primary'} disabled={this.loading} loading={this.loading} onclick={() => this.loadMore()}>\r\n                {app.translator.trans('wusong8899-user-submission.lib.list-load-more')}\r\n              </Button>\r\n            </div>\r\n          )}\r\n\r\n          {loading && <div className=\"UserSubmission-loadMore\">{loading}</div>}\r\n\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  \r\n  hasMoreResults() {\r\n    return this.moreResults;\r\n  }\r\n\r\n  loadMore() {\r\n    this.loading = true;\r\n    this.loadResults(this.userSubmissionList.length);\r\n  }\r\n\r\n  parseResults(results) {\r\n    this.moreResults = !!results.payload.links && !!results.payload.links.next;\r\n    [].push.apply(this.userSubmissionList, results);\r\n\r\n    this.loading = false;\r\n    m.redraw();\r\n\r\n    return results;\r\n  }\r\n\r\n  loadResults(offset = 0) {\r\n    return app.store\r\n      .find(\"userSubmissionList\", {\r\n        page: {\r\n          offset\r\n        },\r\n      })\r\n      .catch(() => {})\r\n      .then(this.parseResults.bind(this));\r\n  }\r\n\r\n}\r\n","import Model from \"flarum/Model\";\r\n\r\nexport default class UserSubmission extends Model {}\r\nObject.assign(UserSubmission.prototype, {\r\n  id: Model.attribute(\"id\"),\r\n  amount: Model.attribute(\"amount\"),\r\n  platform: Model.attribute(\"platform\"),\r\n  platform_account: Model.attribute(\"platform_account\"),\r\n  user_account: Model.attribute(\"user_account\"),\r\n  submission_user_id: Model.attribute(\"submission_user_id\"),\r\n  review_user_id: Model.attribute(\"review_user_id\"),\r\n  review_result: Model.attribute(\"review_result\"),\r\n  assigned_at: Model.attribute(\"assigned_at\"),\r\n  reviewed_at: Model.attribute(\"reviewed_at\"),\r\n  fromUser: Model.hasOne(\"fromUser\"),\r\n  reviewUser: Model.hasOne(\"reviewUser\"),\r\n});\r\n","import SettingsPage from './components/SettingsPage';\r\nimport UserSubmission from \"../forum/model/UserSubmission\";\r\n\r\napp.initializers.add('wusong8899-user-submission', () => {\r\n  app.store.models.userSubmissionList = UserSubmission;\r\n  app.extensionData\r\n    .for('wusong8899-user-submission').registerPage(SettingsPage);\r\n});\r\n"],"names":["UserSubmissionReviewModal","Modal","vnode","Button","e","value","UserSubmissionListItem","Component","itemData","amount","platform","platformAccount","userAccount","fromUser","reviewResult","reviewResultText","assignedAt","reviewedAt","username","DecorationStoreSettings","ExtensionPage","attrs","loading","LoadingIndicator","results","offset","UserSubmission","Model","SettingsPage"],"mappings":"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"}